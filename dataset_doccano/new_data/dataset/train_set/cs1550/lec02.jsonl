{"id": 21, "segment": ["train_set", "labeled"], "course": "cs1550", "lec": "lec02", "text": "Introduction to Operating Systems\nCS/COE 1550\nProcess Synchronization - 1\nSpring 2022\n\nSherif Khattab\nksm73@pitt.edu\n(Some slides are from Silberschatz, Galvin and Gagne \u00a92013)\n\nAnnouncements\n\u2022 Homework 1 is due next Monday at 11:59 pm\n\n\u2022 Recitations started last week\n\u2022 Please watch the videos\n\n\u2022 Lab 1 is due on 2/4 at 11:59 pm\n\u2022 Distributed using GitHub Classroom\n\n\u2022 Explained in this week's recitations\n\n\u2022 Steps of a syscall posted on Canvas\n\u2022 TA Office hours available on the syllabus page\n\u2022 Muddiest points will be anonymous and not seen to\nstudents\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n2\n\nMuddiest Points\n\u2022 storage/access of the mode bits\n\u2022 syscalls\n\u2022\n\nidt/isr vs syscall table\n\n\u2022\n\nDifference between f1~f7(what to call them?) and\nf8~f10(syscall functions)\n\n\u2022\n\nthe beginning of the syscall process\n\n\u2022\n\nsyscall steps\n\n\u2022\n\neax register relevance to interrupts/syscall\n\n\u2022\n\nHow user programs need to be changed for new syscalls\n\n\u2022\n\nHow high level code interacts with syscalls\n\n\u2022 xv6 walkthrough\n\u2022\n\nArray of functions syntax in C\n\n\u2022 monolithic vs micro\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n3\n\nProblem: race conditions\n\u2022 R is a CPU register\n\n\u2022 X is a variable\nstored in memory\n\nP1\nx++\n\nP2\nx++\nx=3\n\nR <= x\nR = R+1\nR => x\n\nR <= x\nR = R+1\nR => x\n\nx=5\nR <= x\n\nR <= x\nR = R+1\nR = R+1\nR => x\nR => x\n\nx=6!\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n4\n\nRace conditions\n\u2022\n\nCooperating processes share storage (memory)\n\n\u2022\n\nBoth may read and write the shared memory\n\n\u2022\n\nProblem: can't guarantee that read followed by write is atomic\n\u2022\n\nAtomic means uninterruptible\n\n\u2022\n\nOrdering matters!\n\n\u2022\n\nThis can result in erroneous results!\n\n\u2022\n\nWe need to eliminate race conditions...\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n5\n\nAtomic operations\n\u2022 If done in one instruction, then not interruptible\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n6\n\nContext Switching\nHow did the CPU switch from P1 to P2 then to P1 then\nto P2 again ...?\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n7\n\nProcess Control Block\n``Active entities are data structures when viewed from a\nlower level.''\n\nRaphael Finkel, University of Kentucky\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n8\n\nProcess Control Block (PCB)\nInformation associated with each process\n(also called task control block)\n\u2022 Process state - running, waiting, etc\n\u2022 Program counter - location of instruction to execute next\n\u2022 CPU registers - contents of all process-centric registers\n\u2022 CPU scheduling information- priorities, scheduling queue\npointers\n\u2022 Memory-management information - memory allocated to\nthe process\n\u2022 Accounting information - CPU used, clock time elapsed\nsince start, time limits\n\u2022 I/O status information - I/O devices allocated to process,\nlist of open files\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n9\n\nProcess Representation in Linux\nRepresented by the C structure task_struct\npid_t pid; /* process identifier */\nlong state; /* state of the process */\nunsigned int time_slice /* scheduling information */\nstruct task_struct *parent; /* this process's parent */\nstruct list_head children; /* this process's children */\nstruct files_struct *files; /* list of open files */\nstruct mm_struct *mm; /* address space of this process */\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n10\n\nContext Switch\n\u2022 When CPU switches to another process, the system\nmust save the state of the old process and load the\nsaved state for the new process via a context\nswitch\n\u2022 Context of a process represented in the PCB\n\u2022 Context-switch time is overhead; the system does no\nuseful work while switching\n\u2022 The more complex the OS and the PCB \u2794 the longer the\ncontext switch\n\n\u2022 Time dependent on hardware support\n\u2022 Some hardware provides multiple sets of registers per\nCPU \u2794 multiple contexts loaded at once\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n11\n\nContext Switching\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n12\n\nXv6 Code Walkthrough\n\u2022 PCB and process table\n\n\u2022 Context switching\n\u2022 Calling of the swtch routine\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n13\n\nContext Switching in Xv6\n%eax\n%edx\n\ncontext\n\nPCB of Process P0\n\nReturn address\n\n%esp\n%eip\n\nStack of Process P0\n\nCPU\nReturn\nReturn address\naddress\n\ncontext\n\nPCB of Process P1\n\nStack of Process P1\nMemory\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n14\n\nCritical regions\n\u2022\n\nBack to the race conditions problem\n\n\u2022\n\nUse critical regions to provide mutual exclusion and help fix race conditions\n\n\u2022\n\nLet's put the statement x++ in a critical region\nP1 enters\ncritical region\n\nP1 leaves\ncritical region\n\nProcess P1\nP2 tries to enter\ncritical region\n\nProcess P2\n\nP2 enters\ncritical region\n\nP2 leaves\ncritical region\n\nP2 blocked\nTime\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n15\n\nHow to implement critical regions?\n\u2022 Turn-based solutions\n\n\u2022 Spinlocks\n\u2022 Semaphores\n\u2022 Monitors\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n16\n\nUsing Spinlocks\nSpinlock lock;\n\nCode for process Pi\n\nWhile(1){\nLock(lock)\n// critical section\nUnlock(lock);\n// remainder of code\n}\n}\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n17\n\nSpinlock implementation (1/2)\n\u2022 Solution: use hardware\n\n\u2022 Several hardware methods\n\u2022 Test & set: test a variable and set it in one instruction\n\u2022 Atomic swap: switch register & memory in one instruction\n\u2022 Turn off interrupts: process won't be switched out unless it\nasks to be suspended\n\n\u2022 The first two methods can be implemented in user\nland\n\u2022 Why can't we implement the third method in user land?\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n18\n\n", "label": [[1398, 1419, "Concept"], [1475, 1488, "Concept"], [1549, 1555, "Concept"], [1559, 1565, "Concept"], [1750, 1756, "Concept"], [5245, 5251, "Concept"], [3297, 3311, "Concept"], [3651, 3665, "Concept"], [2017, 2038, "Concept"], [2205, 2226, "Concept"], [2228, 2231, "Concept"], [3510, 3513, "Concept"], [3630, 3633, "Concept"], [3949, 3952, "Concept"], [4123, 4126, "Concept"], [4234, 4237, "Concept"], [2287, 2305, "Concept"], [2309, 2322, "Concept"], [2349, 2364, "Concept"], [2409, 2422, "Concept"], [2469, 2495, "Concept"], [2537, 2566, "Concept"], [2603, 2625, "Concept"], [2684, 2706, "Concept"], [2878, 2889, "Concept"], [3025, 3036, "Concept"], [3957, 3970, "Concept"], [994, 997, "Concept"], [3926, 3929, "Concept"], [4099, 4102, "Concept"], [4009, 4014, "Concept"], [4509, 4524, "Concept"], [4535, 4550, "Concept"], [4562, 4577, "Concept"], [4608, 4623, "Concept"], [4647, 4662, "Concept"], [4674, 4689, "Concept"], [4989, 5005, "Concept"], [4426, 4442, "Concept"], [4928, 4936, "Concept"], [5100, 5108, "Concept"], [5185, 5195, "Concept"], [5245, 5256, "Concept"], [5304, 5323, "Concept"], [2904, 2922, "Concept"], [2896, 2899, "Concept"], [3209, 3222, "Concept"], [2751, 2761, "Concept"], [3170, 3180, "Concept"], [5488, 5497, "Concept"]]}