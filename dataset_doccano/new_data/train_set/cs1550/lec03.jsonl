{"id": 22, "segment": ["train_set", "labeled"], "course": "cs1550", "lec": "lec03", "text": "Introduction to Operating Systems\nCS/COE 1550\nSpring 2022\n\nSherif Khattab\nksm73@pitt.edu\n(Some slides are from Silberschatz, Galvin and Gagne \u00a92013)\n\nAnnouncements\n\u2022 Homework 1 is due next Monday at 11:59 pm\n\n\u2022 Lab 1 is due on 2/4 at 11:59 pm\n\u2022 Distributed using GitHub Classroom\n\u2022 Explained in this week's recitations\n\n\u2022 TA Office hours available on the syllabus page\n\n\u2022 Project 1 will be up on Canvas this Friday\n\u2022 Docker images are available on Canvas\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n2\n\nMuddiest Points\n\u2022 the while(1) loop in the spinlocks example (just a placeholder I\nassume?)\n\u2022 It would be helpful to have a step-by-step written out\nrepresentation of Context Switching in Xv6 to accompany the\ngraphic\n\u2022 Why only certain registers were pushed/popped in the context\nswitches. Is it just because these are the only registers the\nprocesses could be using?\n\u2022 How can hardware be directly accessed by user tasks, like the\nfirst two options in the spin lock slide? My thought was that\nsomething like an atomic swap would need hard wiring, not\nsoftware\n\u2022 Are race condition prevention methods implemented by the\nprogrammer or the operating system?\n\u2022 What exactly is a critical region again?\n\u2022 Are context switching done by the kernel?\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n3\n\nAgenda\n\u2022 Busy Waiting Problem\n\n\u2022 Why does it happen?\n\u2022 What are its implications?\n\u2022 How to solve it?\n\u2022 Sempahores\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n4\n\nToday's problem: Busy Waiting\n\u2022 A process that is trying to acquire a locked spinlock is\nrunning!\n\u2022 It continuously checks:\n\u2022 can I get the lock? No, lock is held by another process\n\u2022 can I get the lock? No, lock is held by another process\n\u2022 ...\n\n\u2022 This continuous check is called spinning or busy waiting\n\u2022 But what is wrong with that?\n\u2022 Busy waiting wastes CPU cycles\n\u2022 on a single-core system it delays the process that is holding the\nlock from releasing it\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n5\n\nToday's problem: Busy Waiting\nWhile P1 is in the critical region, P2 is busy waiting\nShared Data\nSpinlock lk;\nint x;\nProcess P1\nlock(lk);\n\nProcess P2\nlock(lk);\n\n//critical region (e.g., x++) //critical region (e.g., x++)\nunlock(lk);\n\nunlock(lk);\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n6\n\nBut why?\n\nWhy does busy waiting happen with spinlocks?\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n7\n\nAtomic TestAndSet\n\u2022 TestAndSet is an\natomic instruction\n\nint TestAndSet(int &x){\n\n\u2022 Works for singlecore and multicore Symmetric\nMulti-Processing\n(SMP)\n\nlock memory access to x\nint temp = *x;\n\n*x = 1;\nunlock memory access to x\nreturn temp;\n\n}\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n8\n\nSpinlock implementation using TestAndSet\n\u2022\n\nSingle shared variable: lock\n\n\u2022\n\nWorks for any number of processes\n\nint lock = 0;\nLock(){\nwhile (TestAndSet(&lock))\n;\n}\nUnlock(){\nlock = 0;\n}\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n9\n\nAtomic Swap\n\u2022 Swap is an atomic\ninstruction\n\nint Swap(int &x, int y){\n\n\u2022 Works for singlecore and multicore Symmetric\nMulti-Processing\n(SMP)\n\nlock memory access to x\nint temp = *x;\n\n*x = y;\nunlock memory access to x\nreturn temp;\n\n}\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n10\n\nSpinlock implementation using Swap\n\u2022\n\nSingle shared variable: lock\n\n\u2022\n\nWorks for any number of processes\n\nint lock = 0;\nLock(){\nwhile (Swap(&lock, 1))\n;\n}\nUnlock(){\nlock = 0;\n}\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n11\n\nImplication of Busy Waiting\nSubproblem: priority inversion (higher priority process busy\nwaits for lower priority process)\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n12\n\nImplementation Detail\ncompiler and/or hardware may reorder instructions\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n13\n\nXv6 Walkthrough\n\u2022 Spinlocks\n\u2022 __sync_synchronize() is a memory barrier instruction\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n14\n\n\u2022\n\n\u2022\n\nSemaphores\nSolution: use semaphores\n\u2022\n\nSynchronization mechanism that doesn't require busy waiting\n\nImplementation\n\u2022\n\nSemaphore S accessed by two atomic operations\n\u2022\n\nDown(S): decrement the semaphore if > 0; block otherwise\n\n\u2022\n\nUp(S): increment the semaphore and wakeup one blocked process if any\n\n\u2022\n\nDown() is another name for P()\n\n\u2022\n\nUp() is another name for V()\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n15\n\nBusy waiting vs. Blocking\n\nBlocking involves 2 context switches\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n16\n\nCritical sections using semaphores\nShared variables\nSemaphore sem(1);\n\nCode for process Pi\n\nwhile (1) {\n// non-critical section\ndown(sem);\n// critical section\nup(sem);\n// non-critical section\n}\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n17\n\nTypes of semaphores\n\u2022 Two different types of semaphores\n\u2022 Counting semaphores\n\u2022 Binary semaphores\n\n\u2022 Counting semaphore\n\u2022 Value can range over an unrestricted range\n\n\u2022 Binary semaphore\n\u2022 Only two values possible\n\u2022 1 means the semaphore is available\n\u2022 0 means a process has acquired the semaphore\n\n\u2022 May be simpler to implement\n\n\u2022 Possible to implement one type using the other\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n18\n\nSemaphore Implementation\n\nBut how do semaphores avoid busy waiting?\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n19\n\n\u2022\n\n\u2022\n\nImplementing semaphores with blocking\nAssume two operations:\n\u2022\n\nSleep(): suspends current\nprocess\n\n\u2022\n\nWakeup(P): allows process P\nto resume execution\n\nSemaphore data structure\n\u2022\n\nTracks value of semaphore\n\n\u2022\n\nKeeps a list of processes\nwaiting for the semaphore\nstruct Semaphore {\nint value;\nProcessList pl;\n};\n\ndown ()\n{\nvalue -= 1;\nif (value < 0) {\n// add this process to pl\nSleep ();\n}\n}\nup () {\nProcess P;\nvalue += 1;\nif (value <= 0) {\n// remove a process P\n// from pl\nWakeup (P);\n}\n}\n\nHow to protect these shared variables??\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n20\n\nSpinlocks in Semaphores\ndown ()\n{\nvalue -= 1;\nif (value < 0) {\n// add this process to pl\nSleep ();\n}\nstruct Semaphore {\nint value;\nProcessList pl;\n\n};\n\n}\nup () {\nProcess P;\nvalue += 1;\nif (value <= 0) {\n// remove a process P\n// from pl\nWakeup (P);\n}\n}\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n21\n\nSpinlocks are sometimes better than Semaphores\n\u2022 Very (very) short waiting time to enter the critical\nsection < the 2 context switches needed for blocking\n\u2022 Multi-core\n\u2022 so that the spinlock can be unlocked while the process is busy\nwaiting\n\n\u2022 Few contending processes for the critical section\n\n\u2022 Short critical section code\n\nCS/COE 1550 - Operating Systems - Sherif Khattab\n\n22\n\n", "label": [[1314, 1326, "Concept"], [1490, 1502, "Concept"], [1766, 1778, "Concept"], [1812, 1824, "Concept"], [2005, 2017, "Concept"], [2060, 2072, "Concept"], [2306, 2318, "Concept"], [3463, 3475, "Concept"], [3983, 3995, "Concept"], [4317, 4329, "Concept"], [5168, 5180, "Concept"], [1754, 1762, "Concept"], [1550, 1558, "Concept"], [2085, 2093, "Concept"], [2692, 2700, "Concept"], [3217, 3225, "Concept"], [6315, 6323, "Concept"], [1185, 1200, "Concept"], [2037, 2052, "Concept"], [2151, 2166, "Concept"], [2181, 2196, "Concept"], [4546, 4562, "Concept"], [4577, 4593, "Concept"], [4610, 4626, "Concept"], [6410, 6426, "Concept"], [6436, 6452, "Concept"], [2403, 2413, "Concept"], [2416, 2426, "Concept"], [2457, 2467, "Concept"], [2722, 2732, "Concept"], [2833, 2843, "Concept"], [2433, 2451, "Concept"], [1028, 1032, "Concept"], [2938, 2942, "Concept"], [2945, 2949, "Concept"], [2980, 2984, "Concept"], [3247, 3251, "Concept"], [3352, 3356, "Concept"], [2543, 2546, "Concept"], [3067, 3070, "Concept"], [3488, 3506, "Concept"], [3809, 3823, "Concept"], [3783, 3803, "Concept"], [4015, 4024, "Concept"], [4087, 4096, "Concept"], [4146, 4155, "Concept"], [4487, 4496, "Concept"], [4793, 4802, "Concept"], [4858, 4867, "Concept"], [4909, 4918, "Concept"], [4969, 4978, "Concept"], [5114, 5123, "Concept"], [5394, 5403, "Concept"], [5438, 5447, "Concept"], [5494, 5503, "Concept"], [5511, 5520, "Concept"], [5935, 5944, "Concept"], [4784, 4802, "Concept"], [4851, 4867, "Concept"], [4064, 4068, "Concept"], [4198, 4202, "Concept"], [4563, 4567, "Concept"], [5554, 5558, "Concept"], [5851, 5855, "Concept"], [390, 392, "Concept"], [4125, 4127, "Concept"], [4233, 4235, "Concept"], [4594, 4596, "Concept"], [5633, 5635, "Concept"], [5981, 5983, "Concept"], [4225, 4226, "Concept"], [5352, 5353, "Concept"], [5371, 5372, "Concept"], [5649, 5650, "Concept"], [5702, 5703, "Concept"], [5723, 5724, "Concept"], [5997, 5998, "Concept"], [6050, 6051, "Concept"], [6071, 6072, "Concept"], [4258, 4259, "Concept"], [4334, 4342, "Concept"], [4344, 4352, "Concept"], [5272, 5280, "Concept"], [6279, 6287, "Concept"], [5307, 5312, "Concept"], [5619, 5624, "Concept"], [5916, 5921, "Concept"], [4160, 4166, "Concept"], [5345, 5351, "Concept"], [5715, 5721, "Concept"], [6063, 6069, "Concept"], [5394, 5418, "Concept"], [971, 975, "Concept"], [1613, 1617, "Concept"], [1623, 1627, "Concept"], [1671, 1675, "Concept"], [1681, 1685, "Concept"], [1911, 1915, "Concept"], [2116, 2120, "Concept"], [2138, 2142, "Concept"], [2549, 2553, "Concept"], [2760, 2764, "Concept"], [2808, 2812, "Concept"], [2818, 2822, "Concept"], [2845, 2849, "Concept"], [2866, 2870, "Concept"], [3073, 3077, "Concept"], [3279, 3283, "Concept"], [3327, 3331, "Concept"], [3337, 3341, "Concept"], [3358, 3362, "Concept"], [3382, 3386, "Concept"], [2209, 2215, "Concept"], [2222, 2228, "Concept"], [2597, 2603, "Concept"], [2856, 2862, "Concept"], [3121, 3127, "Concept"], [3372, 3378, "Concept"]]}